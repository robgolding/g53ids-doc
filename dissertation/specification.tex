\chapter{Specification}

This Software Requirements Specification (SRS) was produced with the backing of
\textbf{Servat Ltd.}, of Nottingham.

Servat is primarily an accounting system provider, installing and maintaining
software such as DataFile, Aqilla and SAP for their clients. They also resell
a remote backup service to their customers, based on the \emph{Vembu StoreGrid}
system. This puts the company in an ideal position to offer advice for this
project.

\section{Overview}

\emph{Backtrac Backup System} is an open-source backup system for small to
medium-sized installations, which focuses on version control for individual
files. The system is comprised of two main components: the \emph{server} (of
which there is one per installation), and the \emph{client} (of which there
may be many).

The clients are the computers which contain important data, to be
protected by the system. This data is transferred over the network, and stored
on the server.

The administrator can access the backups via a web interface, which allows
him or her to browse the files that have been archived for all protected
clients.

\section{System Context}

The system will have only minimal interaction with other systems, and all
aspects of the system itself will be self-contained. A dedicated database of
user authentication information will be maintained, meaning that external
factors do not affect the ability of the administrator(s) to access backups.

It is envisaged that the backup server will run on a dedicated hardware
machine, with plentiful storage (ideally in a RAID configuration to guard
against disk failures).

\section{User Requirements}

\subsection{Scenarios}

 - Some user scenarios would be nice. Include *far* too much detail. -

\section{System Architecture}

The system will be composed of three major parts, which operate independently
of one another:

\begin{itemize}
    \item The backup server daemon
    \item The backup client daemon
    \item The backup server web interface
\end{itemize}

\subsection{Server Daemon}

The backup server daemon is the program which will accept incoming connections
from backup clients, and store the archived files on the server's hard disk(s).
It will also keep an up-to-date catalog of all protected files, which can be
accessed by an administrator via the web interface.

\subsubsection{Meta Data}

The server daemon will allow clients to check whether a local file has been
modified, by comparing the file's meta-data to that stored in the catalog. This
meta-data may consists of any or all of the attributes defined in table
\ref{tab:meta-data}.

\begin{table}[h]
    \centering
    \begin{tabular}{| l | l |} \hline
        Field       & Meaning                                       \\ \hline
        size        & File size in bytes                            \\ \hline
        mtime       & File modification time stamp                  \\ \hline
        inode       & The inode number of the file                  \\ \hline
        hash        & A hash (or checksum) of the file's contents   \\ \hline
    \end{tabular}
    \caption{File meta-data}
    \label{tab:meta-data}
\end{table}

This information may then be used to determine whether the file needs to be
archived on the server, or if the current version of the archive is up-to-date.

\subsubsection{Current State}

To allow the client to compare the current file system state with that of the
most up-to-date backup, the server will also allow clients to retrieve the
state of the catalog at the present moment in time. This ``state'' need not
include the meta-data of the archived files, but only their path names---as the
previously mentioned check may be performed to determine whether a backup is
required given that a file exists. The main purpose of this operation is to
notify the server of any files which have been deleted on the client file
system, but still remain in the catalog. This may be as a result of the client
daemon being stopped for some period of time.

\subsubsection{File Transfer}

Once it has been determined that a file must be re-archived (i.e. the file
system contains a more up-to-date version than the backup archive), it will be
transferred from the client to the server daemon. The server will then store
this file in the archive, and record the meta-data in the catalog.

\subsection{Client Daemon}

The client daemon will communicate solely with the server daemon, and will be
unable to access the other parts of the system directly. This will provide not
only security, but should also encourage abstraction when the implementation is
developed to meet this specification.

\subsubsection{Meta Data}

To determine whether or not a given file needs to be archived, the client may
query the server for this information. This query may contain any or all of the
attributes in table \ref{tab:meta-data}.

\subsubsection{Startup Protocol}

When the client program is initially started, it will perform a full scan of
the directories which are configured to backup. Each file will be checked
against the archive, to see if a backup is required. Also, the current state of
the file system will be checked, so as to notify the server of any deletions
that have occurred whilst the daemon was stopped.

\subsubsection{Continuous Backup}

Once started, the client daemon will provide continuous protection for files
that are changed within protected directories on the client computer. If a file
changes on disk, it will be archived within a reasonable amount of time of that
change (i.e. less than one minute).

\subsubsection{File Transfer}

If a server query indicates that a file is in need of archiving, the file
will be transferred to the server and archived.

\subsection{Web Interface}

The purpose of the web interface is to give the administrator(s) access to the
data stored in the catalog, and to configure the system.

\subsubsection{Authentication}

The web interface will be accessible via an authenticated username and
password, provided by the system administrator. No screen will be available to
a user unless they are logged in with these credentials. Instead, the login
screen will be presented to an unauthenticated user, before they may proceed.

\subsubsection{Dashboard}

The ``home'' screen of the web interface will present the user with
a dashboard, showing important system statistics and recently occurred events.

The dashboard will give the administrator an instant overview of the backup
system, including the following information:

\begin{itemize}
    \item Disk usage on the backup server
    \item Backup catalog size
    \item Catalog size history (i.e. a graph showing size over time)
    \item Recent events throughout the system
\end{itemize}

\subsubsection{Clients}

The backup clients will be configured by the administrator via the web
interface. There are a number of different options that will be configurable
for each client, which include (but are not limited to):

\begin{itemize}
    \item Hostname
    \item Secret authentication key (required for the client to connect)
    \item Paths to be protected
    \item Excluded files/folders
\end{itemize}

\subsubsection{Catalog}

To provide access to data in the data in the catalog, the web interface will
present the administrator with a list of clients that are present. Once
a client has been selected, the files and folders that are present on the root
of that client will be displayed. The administrator will then be able to
``drill-down'' into each successive directory, to reach the desired location.

Deleted files will not be shown by default, but an option to show them will be
available so that accidental deletions can be recovered quickly.

\subsubsection{Events}

The system will record the events which occur on each backup client, and
display these events in the web interface. Each event will have an associated
``time of occurrence'', and will be linked with the file to which it relates in
the catalog. An event may be representative of one of the following actions:

\begin{itemize}
    \item File created
    \item File modified
    \item File deleted
\end{itemize}

\subsubsection{Configuration}

The web interface will also provide the main configuration for the system. This
includes options such as globally excluded files (i.e. temporary files that
occur on all clients) and other system-wide preferences.

\section{System Requirements}

\subsection{Functional Requirements}

\begin{enumerate}
    \item Architecture
        \begin{enumerate}
            \item \emph{There shall be only one server (and accompanying web
                interface) per system installation.}
            \item \emph{There may be more than one client per installation,
                with no set maximum number.}
            \item The web interface shall be ``loosely coupled'' from the rest
                of the system, and it's state shall not affect the efficacy of
                the server or client(s) at all.
        \end{enumerate}
    \item Server
        \begin{enumerate}
            \item \emph{The server application shall provide a networked
                daemon, listening for connections from multiple clients.}
            \item \emph{The server shall maintain a catalog, containing the
                file system meta-data for each file in the backup archive, and
                every version thereof.}
            \item The server shall store archived files from all clients in
                a pre-defined location on the file system, in an organised
                manner to allow any past version of a file to be retrieved
            \item The server shall allow clients to perform the following
                operations:
                \begin{enumerate}
                    \item Query a file's meta-data in the catalog
                    \item Create an item in the catalog (i.e. an empty file or
                        directory)
                    \item Transfer a file to the archive
                    \item Restore a file from the archive
                    \item Signify that a file has been deleted
                \end{enumerate}
        \end{enumerate}
    \item Client
        \begin{enumerate}
            \item \emph{The client application shall replicate files in
                protected directories to an archive on the server.}
            \item The client shall perform a scan of the file system on
                startup, archiving any files which are not up-to-date and
                signifying the deletion any files which are no longer present
            \item The client shall provide ``continuous'' file system
                protection whilst is it running, backing up files as soon as
                they are created or modified.
        \end{enumerate}
    \item Web Interface
\end{enumerate}

\subsection{Non-Functional Requirements}

\section{System Models}

\section{System Evolution}

\section{Non Goals}

The system (at least this particular version) will \emph{not} provide the
following features:

\begin{itemize}
    \item Bare-metal disaster recovery for entire operating systems
    \item Cloud support for off-site data storage (e.g. Amazon S3)
\end{itemize}
